---
layout: post
title: 2025-09-23(Tue)
date: 2025-09-23 10:00:00 +0900
categories: post
tags:
  - tech
  - til
  - android
---

# 2025年9月時点で Android アプリの画像を保存するコード
古いバージョンを気にしなくていいなら以下のコードで簡単に保存できる。権限もいらない。

```kotlin
// 保存する画像
val imageBitmap = Bitmap(/*...*/)

if (Build.VERSION_CODES.Q <= Build.VERSION.SDK_INT) {
    CoroutineScope(Dispatchers.IO).launch {
      val contentResolver = context.contentResolver
      val values = ContentValues().also { contentValues ->
          contentValues.put(MediaStore.Images.Media.MIME_TYPE, "image/png")
          contentValues.put(MediaStore.Images.Media.DISPLAY_NAME, "image_${System.currentTimeMillis()}.png")
      }

      val imageUri = contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, values)
          ?: return@launch

      contentResolver.openOutputStream(imageUri)?.use { outputStream ->
          imageBitmap.compress(Bitmap.CompressFormat.PNG, 100, outputStream)
          outputStream.flush()
      }
    }
}
```

Android のファイルの扱いはバージョンごとに変更が入りすぎて互換性を保つのが面倒くさい。


## 参考
[共有ストレージからメディア ファイルにアクセスする | App data and files | Android Developers](https://developer.android.com/training/data-storage/shared/media?hl=ja#add-item)

